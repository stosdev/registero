{% extends "secondary_base.html" %}

{% load bootstrap3 %}
{% load i18n %}

{% block content %}
<h2 class="text-center">{% trans "General information" %}</h2>
<form action="." method="post" class="form">
  {% csrf_token %}
  {% bootstrap_form form %}
  {% buttons %}
  <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> {% trans "Save" %}</button>
  {% endbuttons %}
</form>

<h2 class="text-center">{% trans "Teams" %}</h2>
<p>{% trans "The final contest team list will be filled by choosing teams from each institutes team list. The order in which you provide the teams matters. After you create your teams please drag-and-drop them into an order based on their importance." %}</p>
<div class="teams-container">
{% for team in team_list %}
<div class="panel panel-default">

  <div class="panel-heading">
    <a href="{% url "team.views.delete" team.pk %}" class="btn btn-danger pull-right"><i class="fa fa-trash-o"></i> {% trans "Remove" %}</a>
    <h5>{% trans "Team" %} {{ team.order }}</h5>
  </div>

  <div class="panel-body">

    {% if team.participant_count < 2 or team.participant_count > 3 %}
    <div class="alert alert-warning" role="alert">
      {% trans "The team participant count is not valid. For a team to be considered for the contest it should have between 2 and 3 participants." %}
      <button type="button" class="close" data-dismiss="alert" aria-label="{% trans "Close" %}">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    {% endif %}

    {% if team.participants.all %}
    <table class="table table-stripped table-condensed">
      <thead>
        <tr>
          <th>{% trans "First name" %}</th>
          <th>{% trans "Last name" %}</th>
          <th>{% trans "Shirt size" %}</th>
          <th></th>
        </tr>
      </thead>
      <tbody>

        {% for participant in team.participants.all %}
        <tr>
          <td>{{ participant.first_name }}</td>
          <td>{{ participant.last_name }}</td>
          <td>{{ participant.shirt_size }}</td>
          <td class="text-right">
            <div class="btn-group" role="group">
              <a href="{% url 'participant.views.edit' team.pk participant.pk %}" class="btn btn-xs btn-default"><i class="fa fa-pencil"></i> {% trans "Edit" %}</a>
              <a href="{% url "participant.views.delete" team.pk participant.pk %}" class="btn btn-xs btn-default"><i class="fa fa-trash-o"></i> {% trans "Remove" %}</a>
            </div>
          </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
    {% else %}
    <h4 class="text-center">{% trans "No participants in this team yet." %}</h4>
    {% endif %}

    {% if team.participant_count < 3 %}
    <a href="{% url "participant.views.create" team.pk %}" class="btn btn-primary btn-block"><i class="fa fa-user"></i> {% trans "Add new participant" %}</a>
    {% endif %}

  </div>

</div>
{% empty %}
<h3 class="text-center">{% trans "No teams to show, you can add teams using the button below." %}</h3>
{% endfor %}
</div>
<a href="{% url "team.views.create" %}" class="btn btn-primary btn-block"><i class="fa fa-plus"></i> {% trans "Add new team" %}</a>
{% endblock %}

{% block scripts %}
<script>
  $(document).ready(function(){
    var checked = $('#id_accomodation_required').is(':checked');
    if (!checked) {
      $('#id_institute_address').parent().hide();
      $('#id_institute_nip').parent().hide();
    }
    $('#id_accomodation_required').change(function(){
      $('#id_institute_address').parent().toggle();
      $('#id_institute_nip').parent().toggle();
    });

    $('.teams-container').sortable();
  });
</script>
{% endblock %}
